var RegistroUsuario="";var caso=0;var ManejoRespuestaProcesar=function(b){var a=JSON.parse(b.f_registro_usuario[0].f_registro_usuario);if(a.code=="200"){mensajesAlerta("Procesado!",a.des_code,"info");
Boton_cancelar();limpiarTabla();cargarTablaUsuarios(b.v_usuarios);}else{mensajesAlerta("Error",a.des_code,"error");}};var cargarTablaUsuarios=function(a){$("#tablaUsuarios").dataTable({columnDefs:[{targets:[1],searchable:true}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"user_id",visible:0},{title:"RUT",data:"rut"},{title:"Nombres",data:"name"},{title:"Correo",data:"email"},{title:"Tipo usuario",data:"des_usuario"}],});
};var crearallcombos=function(a){crearcombo("#id_tipo",a);};var cargarFormularioC=function(a){caso=3;$("#spanTitulo").text("Cambio de clave");$("#divTabla").hide();
$("#divForm").show();$("#user_id").val(a.user_id);$(".caja-foto").hide();$(".noCambia").hide();$(".siCambia").show();$(".botonera").show();};var cargarFormulario=function(){caso=2;
$("#divTabla").hide();$("#divForm").show();};var Boton_cancelar=function(){caso=0;$(".foto-perfil").attr("src","/img/foto.png")+"?"+Math.random();$("#spanTitulo").text("");
$("#divForm").hide();$("#divTabla").show();$("#FormUsuario")[0].reset();$("#id_tipo").val("").trigger("change");$("#user_id").val("");$(".botonera").hide();
};var Boton_agregar=function(){cargarFormulario();$("#spanTitulo").text("Registro de usuario");$("#nacionalidad").text("V");$("#user_id").val("");$("#FormUsuario")[0].reset();
$(".caja-foto").hide();$(".siCambia").hide();$(".noCambia").show();$(".botonera").show();};var limpiarTabla=function(){$("#tablaUsuarios").dataTable().fnClearTable();
$("#tablaUsuarios").dataTable().fnDraw();$("#tablaUsuarios").dataTable().fnDestroy();$("#tablaUsuarios thead").empty();};var actualizarFoto=function(){var a=$(this);
var c=$(this).attr("id");if(c=="FormUsuario"){var b="notificacion_resul_fci";}var e=$("#FormUsuario").get(0);var f=new FormData(e);$.ajax({url:rutaF,type:"POST",data:f,cache:false,contentType:false,processData:false,success:function(g){$(".foto-perfil").attr("src",g)+"?"+Math.random();
},error:function(g){alert("ha ocurrido un error al cargar su foto");},});};var cambiarPass=function(){var b=$("#password").val();var a=RegistroUsuario.user_id;
datos=[];datos={caso:caso,password:b,user_id:a};$.ajax({url:ruta,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",async:false,dataType:"JSON",data:{datos:datos},}).done(function(e){var c=JSON.parse(e.f_registro_usuario);
mensajesAlerta("Procesado!",c.des_code,"info");Boton_cancelar();});};var ProcesarUsuario=function(){var c=$("#rut").val();var f=$("#name").val();var e=$("#email").val();
var b=$("#id_tipo").val();var a=$("#_token").val();datos=[];datos={caso:caso,rut:c,name:f,email:e,id_tipo:b,remember_token:a};$.ajax({url:ruta,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",async:false,dataType:"JSON",data:{datos:datos},}).done(function(g){ManejoRespuestaProcesar(g);
});};var validarU=function(){$("#FormUsuario").formValidation("validate");};$(document).ready(function(){$(".botonera").hide();cargarTablaUsuarios(d.v_usuarios);
crearallcombos(d.v_tipo_usuario);var a=$("#tablaUsuarios").dataTable();$("#tablaUsuarios tbody").on("click","tr",function(b){a.$("tr.selected").removeClass("selected");
$(this).addClass("selected");RegistroUsuario=TablaTraerCampo("tablaUsuarios",this);});a.on("dblclick","tr",function(){$("#close").trigger("click");});$(function(){$.contextMenu({selector:"#tablaUsuarios",callback:function(c,b){switch(c){case"1":cargarFormularioC(RegistroUsuario);
break;}},items:{"1":{name:"Reiniciar clave",icon:"edit"},}});});$(document).on("click","#guardar",validarU);$(document).on("click","#cancelar",Boton_cancelar);
$(document).on("click","#agregar",Boton_agregar);$(document).on("click","#cancelarP",Boton_cancelar);$(document).on("click","#guardarP",validarU);$("#FormUsuario").formValidation({fields:{rut:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},name:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},password:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},email:{validators:{notEmpty:{message:"El campo es requerido."},emailAddress:{message:"Ingrese una direcci√≥n de correo valida"}}},}}).on("success.form.fv",function(b){if(caso==2){ProcesarUsuario();
}if(caso==3){cambiarPass();}}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});