var Registroinstalacion="";var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};var ManejoRespuesta=function(a){if(a.code=200){$("#foto-instalacion1").attr("src","/img/home.png")+"?"+Math.random();
destruirTablaS("tablaInstalaciones");cargarTablaInstalaciones(a.respuesta);}else{mensajesAlerta("Error","Ocurrio un error al eliminar las imagenes","error");
}};var ManejoRespuestaI=function(b){if(b.code=="200"){var a=JSON.parse(b.respuesta.f_registro_instalacion[0].f_registro_instalacion);switch(a.code){case"200":mensajesAlerta("Procesado!",a.des_code,"info");
limpiarTabla();cargarTablaInstalaciones(b.respuesta.v_instalaciones);agregarFoto();$("#id_instalacion").val(a.id_instalacion);$("#id_instalacion2").val(a.id_instalacion);
break;case"-2":mensajesAlerta("Error",a.des_code,"error");break;default:mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}};var cargarTablaInstalaciones=function(a){$("#tablaInstalaciones").dataTable({columnDefs:[{targets:-1,data:null,targets:[1],searchable:true,}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id_instalacion",visible:0},{title:"Instalación",data:"des_descripcion"},{title:"Descripción",data:"descripcion"},{title:"Activo",data:"activo_instalacion",visible:0},{title:"Sede",data:"id_sede",visible:0}],});
};var Procesarinstalacion=function(){var c=$("#id_descripcion").val();var b=$("#descripcion").val();var a=$("#id_instalacion").val();parametroAjax.ruta=ruta;
parametroAjax.data={id_descripcion:c,descripcion:b,id_instalacion:a};respuesta=procesarajax(parametroAjax);ManejoRespuestaI(respuesta);};var agregarFoto=function(){$("#cancelar").html(" Volver");
$(".divCam").show();};var crearallcombos=function(a){crearcombo("#id_descripcion",a);};var cargarForm=function(){$(".divCam").hide();$("#divTabla").hide();
$("#divForm").show();$("#id_instalacion").val("");$("#Forminstalacion")[0].reset();$(".comboclear").val("").trigger("change");};var cargarTabla=function(){limpiar();
$("#divForm").hide();$("#divTabla").show();$(".divCam").hide();$("#cancelar").html(" Cancelar");};var limpiar=function(){$("#Forminstalacion")[0].reset();
$("#FormFotos")[0].reset();$("#id_ciudad").val("").trigger("change");$("#id_instalacion").val("");$("#id_instalacion2").val("");$("#foto-instalacion1").attr("src","/img/home.png")+"?"+Math.random();
};var pintarDatosActualizar=function(a){$("#divTabla").hide();$("#divForm").show();$(".divCam").show();if(a.id_instalacion!=null){$("#id_instalacion").val(a.id_instalacion);
}if(a.id_instalacion!=null){$("#id_instalacion2").val(a.id_instalacion);}if(a.id_descripcion!=null){$("#id_descripcion").val(a.id_descripcion).trigger("change");
}if(a.descripcion!=null){$("#descripcion").val(a.descripcion);}if(a.activo_sede="false"){$("#activo_sede").prop("checked",false);}if(a.foto1!=null){if(a.foto1.length>3){$("#foto-instalacion1").attr("src",a.foto1)+"?"+Math.random();
}}$("#cancelar").html(" Volver");};var eliminarFotoC=function(){var a=$("#id_instalacion2").val();parametroAjax.ruta=rutaE;parametroAjax.data={id_instalacion:a};
respuesta=procesarajax(parametroAjax);ManejoRespuesta(respuesta);};var actualizarFotos=function(){var a=$(this);var c=$(this).attr("id");if(c=="FormFotos"){var b="notificacion_resul_fci";
}var e=$("#FormFotos").get(0);var f=new FormData(e);$.ajax({url:rutaF,type:"POST",data:f,cache:false,contentType:false,processData:false,success:function(h){var g=JSON.parse(h);
switch(g.code){case"-2":mensajesAlerta("Error!",g.des_code,"error");break;case"200":mensajesAlerta("Procesado!",g.des_code,"info");if(g.foto1!=null){if(g.foto1.length>3){$("#foto-instalacion1").attr("src",g.foto1)+"?"+Math.random();
}}limpiarTabla();cargarTablaInstalaciones(g.v_instalaciones);break;default:mensajesAlerta("Error!","Error de registro. Intente nuevamente, si el error persite contacte al personal informático.","error");
}},error:function(g){mensajesAlerta("Error!","ha ocurrido un error al cargar su foto","error");},});};var validarC=function(){$("#Forminstalacion").formValidation("validate");
};var limpiarTabla=function(){destruirTablaS("tablaInstalaciones");};var cargarFotos=function(){$("#divFotos").window("open");};$(document).ready(function(){$("#tituloPantalla").text(d.title);
cargarTablaInstalaciones(d.v_instalaciones);crearallcombos(d.v_instalaciones_combo);$(document).on("click","#guardar",validarC);$(document).on("click","#agregar",cargarForm);
$(document).on("click","#cancelar",cargarTabla);$(document).on("click","#guardarF",cargarFotos);$(document).on("click","#cargar",actualizarFotos);$(document).on("click","#eliminar",eliminarFotoC);
var a=$("#tablaInstalaciones").dataTable();$("#tablaInstalaciones tbody").on("click","tr",function(b){a.$("tr.selected").removeClass("selected");$(this).addClass("selected");
Registroinstalacion=TablaTraerCampo("tablaInstalaciones",this);});a.on("dblclick","tr",function(){$("#close").trigger("click");});$(function(){$.contextMenu({selector:"#tablaInstalaciones",callback:function(c,b){switch(c){case"1":pintarDatosActualizar(Registroinstalacion);
break;}},items:{"1":{name:"Editar",icon:"edit"},}});});$("#Forminstalacion").formValidation({fields:{id_descripcion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},descripcion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},}}).on("success.form.fv",function(b){Procesarinstalacion();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});