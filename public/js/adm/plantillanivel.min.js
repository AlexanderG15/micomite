var v_id_modulos_poderes=0;var procesarajax=function(c,b,a){$.ajax({url:b,headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},type:"POST",async:false,dataType:"JSON",data:c,}).done(function(e){switch(a){case 1:console.log(e);
$("#id_poder").empty();$("#id_poder").select2({placeholder:"Seleccione...",data:e,language:"es"});break;case 2:destruirTabla();mensajesAlerta("Procesado!","Se eliminó con éxito.","info");
actualizarDatos(e);var d=$("#TablaPerfilModulosPoderes").dataTable();d.fnFilter("^"+$("#id_perfil").val()+"$",4,true);break;case 3:destruirTabla();mensajesAlerta("Procesado!","Se registró con éxito.","info");
actualizarDatos(e);}}).fail(function(e,d){var f="";if(e.status===0){f="Not connect.\n Verify Network.";}else{if(e.status==422){}else{if(e.status==404){f="Requested page not found. [404]";
}else{if(e.status==500){f="Internal Server Error [500]. Si el error persiste comuníquese con informática.";}else{if(d==="parsererror"){f="Requested JSON parse failed.";
}else{if(d==="timeout"){f="Time out error.";}else{if(d==="abort"){f="Ajax request aborted.";}else{f="Uncaught Error.\n"+e.responseText;}}}}}}}mensajesAlerta("Error",f,"error");
});};var deletemodulopoder=function(a){$.messager.confirm("Confirmación","Seguro desea eliminar "+a.toString().split(",").length,function(b){if(b){procesarajax({id_plantilla_nivel:a},datos.rutaDeletePlantillaNivel,2);
$("#id_poder").val(null).trigger("change");if(TablaNroRegistroFil("TablaPerfilModulosPoderes")>0){menuC();}filtrarPerfilModulos($("#id_perfil").val(),$("#id_modulo").val());
}});};var addmodulopoder=function(){procesarajax({id_perfil:$("#id_perfil").val(),poderes:$("#id_poder").val(),id_tipo_modulo_id_modulo:$("#id_modulo").val()},datos.rutaAddPlantillaNivel,3);
$("#id_poder").val(null).trigger("change");var a=$("#TablaPerfilModulosPoderes").dataTable();a.fnFilter("^"+$("#id_perfil").val()+"$",4,true);a.fnFilter("^"+$("#id_modulo").val()+"$",2,true);
$("#id_poder").val(null).trigger("change");if(TablaNroRegistroFil("TablaPerfilModulosPoderes")>0){menuC();}};var actualizarDatos=function(a){$("#TablaPerfilModulosPoderes").dataTable({aLengthMenu:[[4,10,-1],[4,10,"All"]],language:lenguajeTabla,data:a,columns:[{title:"Módulo",data:"des_cod_modulo"},{title:"Poder",data:"des_poder"},{title:"id_tipo_modulo_id_modulo",data:"id_tipo_modulo_id_modulo",visible:0},{title:"id_poder",data:"id_poder",visible:0},{title:"id_nivel",data:"id_nivel",visible:0},{title:"id_plantilla_nivel",data:"id_plantilla_nivel",visible:0},{title:"id_modulo",data:"id_modulo",visible:0},],scrollY:"200px",scrollCollapse:true,paging:false});
menuC();};var destruirTabla=function(){$("#TablaPerfilModulosPoderes").dataTable().fnClearTable();$("#TablaPerfilModulosPoderes").dataTable().fnDraw();
$("#TablaPerfilModulosPoderes").dataTable().fnDestroy();};function agregarRol(){$("#formPlantillaPerfil").formValidation("validate");}var validarModuloPoder=function(f,e,c){var a=$("#TablaPerfilModulosPoderes").dataTable();
var d=0;var b="";if(f&&e){$(a.fnGetNodes()).each(function(j){var g=a.fnGetPosition(this);var h=a.fnGetData(g[0]);if(h[j]["id_tipo_modulo_id_modulo"]==f&&h[j]["id_nivel"]==c){if(h[j]["id_poder"]==1){d=1;
}else{$.each(e,function(i,k){if(k==h[j]["id_poder"]){b=h[j]["des_poder"];d=2;}});}}});}switch(d){case 1:return{valid:false,message:"Verifique ya posee todos los poderes"};
case 2:return{valid:false,message:"Verifique ya posee "+b+" para este módulo"};break;default:return true;}};var FilMenuContextual=function(a){if(TablaNroSeleccionado("TablaPerfilModulosPoderes")==0){$("#mm").menu("hideItem",$("#quitarseleccion")[0]);
$("#mm").menu("hideItem",$("#del-sel")[0]);}else{$("#mm").menu("showItem",$("#quitarseleccion")[0]);$("#mm").menu("showItem",$("#del-sel")[0]);}};var filtrarPerfilModulos=function(b,c){var a=$("#TablaPerfilModulosPoderes").dataTable();
if(b){a.fnFilter("^"+b+"$",4,true);}else{a.fnFilter("",4);}if(c){a.fnFilter("^"+c+"$",2,true);}else{a.fnFilter("",2);}if(TablaNroRegistroFil("TablaPerfilModulosPoderes")>0){menuC();
}};var eliminar=function(){deletemodulopoder(v_id_modulos_poderes);};var eliminarseleccion=function(){deletemodulopoder(TabalRegistroSelected.join());};
var menuC=function(){if(TablaNroRegistro("TablaPerfilModulosPoderes")>0){$("#TablaPerfilModulosPoderes tbody tr").bind("contextmenu",function(a){a.preventDefault();
v_id_modulos_poderes=TablaTraerCampo("TablaPerfilModulosPoderes",this).id_plantilla_nivel;FilMenuContextual();if(TablaNroRegistro("TablaPerfilModulosPoderes")>0){$("#mm").menu("show",{left:a.pageX,top:a.pageY});
}});}};$(document).ready(function(){actualizarDatos(datos.TablaPerfilModulosPoderes);$("#id_perfil").select2({language:"es"}).on("change",function(c){filtrarPerfilModulos($("#id_perfil").val(),$("#id_modulo").val());
TablaDesSelAll("TablaPerfilModulosPoderes");$("#id_poder").val(null).trigger("change");});$("#id_modulo").select2({placeholder:"Seleccione...",allowClear:true,language:"es"}).on("change",function(c){filtrarPerfilModulos($("#id_perfil").val(),$("#id_modulo").val());
if($("#id_modulo").val()){procesarajax({id_tipo_modulo_id_modulo:$("#id_modulo").val()},datos.filtrarpoder,1);}else{$("#id_poder").empty();}$("#id_poder").val(null).trigger("change");
TablaDesSelAll("TablaPerfilModulosPoderes");});$("#id_poder").select2({placeholder:"Seleccione...",allowClear:true,language:"es"});var b=$("#formPlantillaPerfil").formValidation({message:"El módulo le falta un campo para ser completado",fields:{id_perfil:{verbose:false,validators:{notEmpty:{message:"El campo es requerido"}}},id_modulo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido"},callback:{callback:function(f,d,e){var g=d.getFieldElements("id_modulo").val();
var c=d.getFieldElements("id_poder[]").val();return validarModuloPoder(g,c,$("#id_perfil").val());}}}},"id_poder[]":{verbose:false,validators:{choice:{min:1,message:"Por favor seleccione %s, como mínimo"},callback:{callback:function(f,d,e){var g=d.getFieldElements("id_modulo").val();
var c=e.val();if(c){if(c.length>1){if($.inArray("1",c)>-1){return{valid:false,message:"La opción todo debe ser única"};}}}return validarModuloPoder(g,c,$("#id_perfil").val());
}}}}}}).on("success.form.fv",function(c){addmodulopoder();}).on("status.field.fv",function(d,c){c.element.parents(".form-group").removeClass("has-success");
c.fv.disableSubmitButtons(true);});$(document).on("click","#agregar",agregarRol);TablaSeleccionRegitro("TablaPerfilModulosPoderes","id_plantilla_nivel");
var a=$("#TablaPerfilModulosPoderes").dataTable();a.fnFilter("^2$",4,true);if(TablaNroRegistroFil("TablaPerfilModulosPoderes")>0){menuC();}});