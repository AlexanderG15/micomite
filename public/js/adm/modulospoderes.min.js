var v_id_modulos_poderes=0;var procesarajax=function(c,b,a){$.ajax({url:b,headers:{"X-CSRF-TOKEN":$("input[name=_token]").val()},type:"POST",async:false,dataType:"JSON",data:c,}).done(function(d){switch(a){case 2:destruirTabla();
mensajesAlerta("Procesado!","Se eliminó con éxito.","info");break;case 3:destruirTabla();mensajesAlerta("Procesado!","Se registró con éxito.","info");break;
}actualizarDatos(d);}).fail(function(e,d){var f="";if(e.status===0){f="Not connect.\n Verify Network.";}else{if(e.status==422){}else{if(e.status==404){f="Requested page not found. [404]";
}else{if(e.status==500){f="Internal Server Error [500]. Si el error persiste comuníquese con informática.";}else{if(d==="parsererror"){f="Requested JSON parse failed.";
}else{if(d==="timeout"){f="Time out error.";}else{if(d==="abort"){f="Ajax request aborted.";}else{f="Uncaught Error.\n"+e.responseText;}}}}}}}mensajesAlerta("Error",f,"error");
});};var mostrardatos=function(a){procesarajax({rel_id_modulo:a},datos.rutalistar,1);};var deletemodulopoder=function(a){$.messager.confirm("Confirmación","Seguro desea eliminar "+a.toString().split(",").length,function(c){if(c){procesarajax({id_tipo_modulo_poder:a},datos.rutadeletemodulopoder,2);
var b=$("#tablaModulospoderes").dataTable();b.fnFilter("^"+$("#id_modulo").val()+"$",2,true);$("#id_poder").val(null).trigger("change");if(TablaNroRegistroFil("tablaModulospoderes")>0){menuC();
}}});};var addmodulopoder=function(){procesarajax({poderes:$("#id_poder").val(),id_tipo_modulo_id_modulo:$("#id_modulo").val()},datos.rutaaddmodulopoder,3);
$("#id_poder").val(null).trigger("change");if($("#id_modulo").val()){var a=$("#tablaModulospoderes").dataTable();a.fnFilter("^"+$("#id_modulo").val()+"$",2,true);
}$("#id_poder").val(null).trigger("change");menuC();};var actualizarDatos=function(a){$("#tablaModulospoderes").dataTable({aLengthMenu:[[4,10,-1],[4,10,"All"]],language:lenguajeTabla,data:a,columns:[{title:"Módulo",data:"des_cod_modulo"},{title:"Poder",data:"des_poder"},{title:"id_tipo_modulo_id_modulo",data:"id_tipo_modulo_id_modulo",visible:0},{title:"id_modulos_poderes",data:"id_modulos_poderes",visible:0},],scrollY:"200px",scrollCollapse:true,paging:false});
menuC();};var destruirTabla=function(){$("#tablaModulospoderes").dataTable().fnClearTable();$("#tablaModulospoderes").dataTable().fnDraw();$("#tablaModulospoderes").dataTable().fnDestroy();
};var agregarRol=function(){$("#formmodulospoderes").formValidation("validate");};var validarModuloPoder=function(e,d){if(TablaNroRegistro("tablaModulospoderes")>0){var a=$("#tablaModulospoderes").dataTable();
var c=0;var b="";if(e&&d){$(a.fnGetNodes()).each(function(h){var f=a.fnGetPosition(this);var g=a.fnGetData(f[0]);if(g[h]["id_tipo_modulo_id_modulo"]==e){if(g[h]["id_poder"]==1){c=1;
}else{$.each(d,function(i,j){if(j==g[h]["id_poder"]){b=g[h]["des_poder"];c=2;}});}}});}switch(c){case 1:return{valid:false,message:"Verifique ya posee todos los poderes"};
case 2:return{valid:false,message:"Verifique ya posee "+b+" para este módulo"};break;default:return true;}}};var FilMenuContextual=function(a){if(TablaNroSeleccionado("tablaModulospoderes")==0){$("#mm").menu("hideItem",$("#quitarseleccion")[0]);
$("#mm").menu("hideItem",$("#del-sel")[0]);}else{$("#mm").menu("showItem",$("#quitarseleccion")[0]);$("#mm").menu("showItem",$("#del-sel")[0]);}};var eliminar=function(){deletemodulopoder(v_id_modulos_poderes);
};var eliminarseleccion=function(){deletemodulopoder(TabalRegistroSelected.join());};var menuC=function(){if(TablaNroRegistro("tablaModulospoderes")>0){$("#tablaModulospoderes tbody tr").bind("contextmenu",function(a){a.preventDefault();
v_id_modulos_poderes=TablaTraerCampo("tablaModulospoderes",this).id_modulos_poderes;FilMenuContextual();if(TablaNroRegistro("tablaModulospoderes")>0){$("#mm").menu("show",{left:a.pageX,top:a.pageY});
}});}};$(document).ready(function(){TabalRegistroSelected=[];actualizarDatos(datos.TablaModulosPoderes);var a=$("#formmodulospoderes").formValidation({message:"El módulo le falta un campo para ser completado",fields:{id_modulo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido"},callback:{callback:function(e,c,d){var f=c.getFieldElements("id_modulo").val();
var b=c.getFieldElements("id_poder[]").val();return validarModuloPoder(f,b);}}}},"id_poder[]":{verbose:false,validators:{choice:{min:1,message:"Por favor seleccione %s, como mínimo"},callback:{callback:function(e,c,d){var f=c.getFieldElements("id_modulo").val();
var b=d.val();if(b){if(b.length>1){if($.inArray("1",b)>-1){return{valid:false,message:"La opción todo debe ser única"};}}}return validarModuloPoder(f,b);
}}}}}}).on("success.form.fv",function(b){addmodulopoder();}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");
b.fv.disableSubmitButtons(true);});$("#id_modulo").select2({placeholder:"Seleccione...",allowClear:true,}).on("change",function(c){var b=$("#tablaModulospoderes").dataTable();
if($("#id_modulo").val()){b.fnFilter("^"+$("#id_modulo").val()+"$",2,true);}else{b.fnFilter("","2");}TabalRegistroSelected=[];$("#id_poder").val(null).trigger("change");
if(TablaNroRegistroFil("tablaModulospoderes")>0){menuC();}});$("#id_poder").select2({placeholder:"Seleccione...",allowClear:true,});$(document).on("click","#agregar",agregarRol);
TablaSeleccionRegitro("tablaModulospoderes","id_modulos_poderes");menuC();});