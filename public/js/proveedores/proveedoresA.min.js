var RegistroProveedores="";var combos=caso=0;var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};var ManejoRespuestaProcesar=function(b){if(b.code=="200"){var a=JSON.parse(b.respuesta.f_registro_proveedor[0].f_registro_proveedor);
switch(a.code){case"200":mensajesAlerta("Procesado!",a.des_code,"info");$(".caja-foto").show();destruirTablaS("tablaProveedores");cargarTablaProveedores(b.respuesta.v_proveedores);
$("#id_proveedor").val(a.id_proveedor);break;case"-2":mensajesAlerta("Error",a.des_code,"error");break;default:mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}};var cargarTablaProveedores=function(a){$("#tablaProveedores").dataTable({columnDefs:[{targets:-1,data:null,targets:[1],searchable:true,}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id_proveedor",visible:0},{title:"RUT",data:"rut"},{title:"Nombres",data:"nombres"},{title:"Correo",data:"email"},{title:"Teléfono",data:"telefono1"},{title:"Movil",data:"movil"},{title:"Dirección",data:"direccion"},{title:"Comunas",data:"des_comunas"}],});
};var crearallcombos=function(a){crearcombo("#id_rubro","");crearcombo("#id_comunas","");};var Boton_agregar=function(){$("#spanTitulo").text("Registro de proveedores de servicios");
$(".divForm").toggle();$(".caja-foto").hide();$("#FormProveedores")[0].reset();$("#id_proveedor").val("");$(".comboclear").val("").trigger("change");};
var Boton_cancelar=function(){$("#spanTitulo").text("Proveedores de servicios");$(".divForm").toggle();$(".caja-foto").hide();$("#FormProveedores")[0].reset();
$("#id_proveedor").val("");$(".comboclear").val("").trigger("change");$(".foto-perfil").attr("src","/img/edificio.png")+"?"+Math.random();};var pintarDatosActualizar=function(b){$(".caja-foto").show();
$(".divForm").toggle();$("#spanTitulo").text("Actualización de datos");if(b.urlimage!=null){if(b.urlimage.length>4){$(".foto-perfil").attr("src",b.urlimage)+"?"+Math.random();
$("#image").val(b.urlimage);}}if(b.id_proveedor!=null){$("#id_proveedor").val(b.id_proveedor);}if(b.rut!=null){$("#rut").val(b.rut);}if(b.nombres!=null){$("#nombres").val(b.nombres);
}if(b.email!=null){$("#email").val(b.email);}if(b.direccion!=null){$("#direccion").val(b.direccion);}if(b.telefono1!=null){var a=b.telefono1.split("-");
$("#paist1").val(a[0]);$("#codigot1").val(a[1]);$("#numerot1").val(a[2]);}if(b.telefono2!=null){var a=b.telefono2.split("-");$("#paist2").val(a[0]);$("#codigot2").val(a[1]);
$("#numerot2").val(a[2]);}if(b.movil!=null){var a=b.movil.split("-");$("#paism").val(a[0]);$("#codigom").val(a[1]);$("#numerom").val(a[2]);}if(b.website!=null){$("#website").val(b.website);
}if(b.id_rubro!=null){$("#id_rubro").val(b.id_rubro).trigger("change");}if(b.id_comunas!=null){var a=b.id_comunas.split(",");$("#id_comunas").val(a).trigger("change");
}if(b.descripcion!=null){$("#descripcion").val(b.descripcion);}if(!b.activo){$("#activo").prop("checked",false);}else{$("#activo").prop("checked",true);
}};var ProcesarProveedor=function(){var a=$("#id_comunas").val().toString();var a={comunas:a};parametroAjax.data=$("#FormProveedores").serialize()+"&"+$.param(a);
parametroAjax.ruta=ruta;respuesta=procesarajax(parametroAjax);ManejoRespuestaProcesar(respuesta);};var mostrarDependientes=function(a){switch(parseInt($("#id_tipo_seguridad").val())){case 1:$("#divSegExterna").hide();
break;case 2:$("#divSegExterna").show();break;default:$("#divSegExterna").hide();break;}};var eliminarFoto=function(){$.ajax({url:rutaE,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",data:{id_proveedor:$("#id_proveedor").val()},async:false,dataType:"JSON",}).done(function(a){console.log(a);
$(".foto-perfil").attr("src","/img/edificio.png")+"?"+Math.random();destruirTablaS("tablaProveedores");cargarTablaProveedores(a);});};var actualizarFoto=function(){var a=$(this);
var b=$(this).attr("id");var c=$("#FormProveedores").get(0);var e=new FormData(c);$.ajax({url:rutaF,type:"POST",data:e,cache:false,contentType:false,processData:false,success:function(f){console.log(f);
if(f=="-2"){alert("Debe agregar una foto");}else{$(".foto-perfil").attr("src",f.rutadelaimagen)+"?"+Math.random();destruirTablaS("tablaProveedores");cargarTablaProveedores(f.v_proveedores);
}},error:function(f){alert("ha ocurrido un error al cargar su foto");},});};var validarS=function(){$("#FormProveedores").formValidation("validate");};
$(document).ready(function(){$("#checkbox").click(function(){if($("#checkbox").is(":checked")){$("#id_comunas").find("option").prop("selected",true);$("#id_comunas").trigger("change");
}else{$("#id_comunas").find("option").prop("selected",false);$("#id_comunas").trigger("change");}});$("#spanTitulo").text("Proveedores de servicios");$("#activo").attr("checked",true);
cargarTablaProveedores(d.v_proveedores);crearallcombos(d);$("#id_tipo_seguridad").change(function(){mostrarDependientes(combos);});$("#rutE").focusout(function(){var b=$("#rutE").val();
if(b.length>5){consultarResponsable(b);}});var a=$("#tablaProveedores").dataTable();$("#tablaProveedores tbody").on("click","tr",function(b){a.$("tr.selected").removeClass("selected");
$(this).addClass("selected");RegistroProveedores=TablaTraerCampo("tablaProveedores",this);});a.on("dblclick","tr",function(){$("#close").trigger("click");
});$(function(){$.contextMenu({selector:"#tablaProveedores",callback:function(c,b){switch(c){case"1":pintarDatosActualizar(RegistroProveedores);break;}},items:{"1":{name:"Editar",icon:"edit"},}});
});$(document).on("click","#agregar",Boton_agregar);$(document).on("click","#cancelar",Boton_cancelar);$(document).on("click","#cargar",actualizarFoto);
$(document).on("click","#eliminar",eliminarFoto);$(document).on("click","#guardar",validarS);$("#FormProveedores").formValidation({fields:{rut:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},nombres:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},email:{validators:{emailAddress:{message:"Ingrese una dirección de correo valida"}}},direccion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},paism:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},codigom:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},numerom:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},paist1:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},codigot1:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},numerot1:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},paist2:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},codigot2:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},numerot2:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},website:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},cargo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},sueldo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_rubro:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_comunas:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},descripcion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},}}).on("success.form.fv",function(b){ProcesarProveedor();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});