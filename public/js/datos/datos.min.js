var RegitroUsuario="";var caso=boton=0;var ManejoRespuestaProcesar=function(b){var a=JSON.parse(b.f_actualizacion_usuario[0].f_actualizacion_usuario);if(a.code="200"){mensajesAlerta("Procesado!",a.des_code,"info");
}else{mensajesAlerta("Error",a.des_code,"error");}};var ManejoRespuestaProcesarComite=function(a){switch(a.resultado){case"200":$("#myModal").modal("hide");
$("#divParticipante").show();$("#modal").hide();$("#spanComite").text(" Es participante del Comité con el cargo: "+a.cargo);mensajesAlerta("Procesado!","Registro éxitoso","info");
$("#cargo").val("");boton=1;break;case"300":$("#spanComite").text("");$("#myModal").modal("hide");$("#modal").show();$("#divParticipante").hide();mensajesAlerta("Procesado!","Procesado éxitosamente","info");
boton=2;break;default:mensajesAlerta("Error","Se ha encontrado un error comunicarse con el personal informático","error");}};var cargarFormularioC=function(a){caso=3;
$("#spanTitulo").text("Cambio de clave");$("#divForm").show();$("#user_id").val(a.user_id);$(".caja-foto").hide();$(".noCambia").hide();$(".siCambia").show();
$(".botonera").show();};var cargarFormulario=function(){caso=2;$("#divForm").show();};var pintarDatosActualizar=function(c,a){if(a!=null){$("#spanCondominio").text(a);
}if(c.urlimage!=null){if(c.urlimage.length>1){$(".foto-perfil").attr("src",c.urlimage)+"?"+Math.random();$("#image").val(c.urlimage);}}$("#spanTitulo").text("Actualización de datos");
$("#user_id").val(c.user_id);if(c.rut!=null){$("#rut").val(c.rut);}if(c.direccion!=null){$("#direccion").val(c.direccion);}if(c.name!=null){$("#name").val(c.name);
}if(c.email!=null){$("#email").val(c.email);}if(c.sexo!=null){if(c.sexo=="f"){$(".sexof").attr("checked",true);$(".sexom").attr("checked",false);}else{$(".sexom").attr("checked",true);
$(".sexof").attr("checked",false);}}if(c.telefonoresidencial!=null){var b=c.telefonoresidencial.split("-");$("#paist").val(b[0]);$("#codigot").val(b[1]);
$("#numerot").val(b[2]);}if(c.movil!=null){var b=c.movil.split("-");$("#paism").val(b[0]);$("#codigom").val(b[1]);$("#numerom").val(b[2]);}if(c.fecha_nacimiento!=null){$("#fecha_nacimiento").val(moment(c.fecha_nacimiento).format("DD/MM/YYYY"));
}$(".siCambia").hide();$(".noCambia").show();$(".botonera").show();$(".caja-foto").show();};var Boton_cancelar=function(){caso=0;$(".foto-perfil").attr("src","/img/foto.png")+"?"+Math.random();
$("#spanTitulo").text("");$("#divForm").hide();$("#FormUsuario")[0].reset();$("#user_id").val("");$(".botonera").hide();};var Boton_agregar=function(){cargarFormulario();
$("#spanTitulo").text("Registro de usuario");$("#user_id").val("");$("#FormUsuario")[0].reset();$(".caja-foto").hide();$(".siCambia").show();$(".noCambia").show();
$(".botonera").show();};var eliminarFoto=function(){$.ajax({url:rutaE,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",data:{user_id:$("#user_id").val(),urlimage:$("#image").val()},async:false,dataType:"JSON",}).done(function(a){$(".foto-perfil").attr("src","/img/foto.png")+"?"+Math.random();
});};var actualizarFoto=function(){var a=$(this);var c=$(this).attr("id");if(c=="FormUsuario"){var b="notificacion_resul_fci";}var e=$("#FormUsuario").get(0);
var f=new FormData(e);$.ajax({url:rutaF,type:"POST",data:f,cache:false,contentType:false,processData:false,success:function(g){if(g=="-2"){alert("Debe agregar una foto");
}else{$(".foto-perfil").attr("src",g)+"?"+Math.random();}},error:function(g){alert("ha ocurrido un error al cargar su foto");},});};var ProcesarUsuario=function(){var i=$("#user_id").val();
var a=$("#rut").val();var b=$("#name").val();var h=$("#email").val();var c=$("#direccion").val();var e=$("#paist").val()+"-"+$("#codigot").val()+"-"+$("#numerot").val();
var j=$("#paism").val()+"-"+$("#codigom").val()+"-"+$("#numerom").val();var g=$("#fecha_nacimiento").val();var f=$("input[name=sexo]:checked").val();datos=[];
datos={user_id:i,rut:a,name:b,email:h,direccion:c,telefonoresidencial:e,movil:j,fecha_nacimiento:g,sexo:f};$.ajax({url:ruta,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",async:false,dataType:"JSON",data:{datos:datos},}).done(function(k){ManejoRespuestaProcesar(k);
});};var ProcesarComite=function(){var a=$("#user_id").val();var b=$("#cargo").val();boton=boton;datos=[];datos={user_id:a,cargo:b,boton:boton};$.ajax({url:rutaC,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",async:false,dataType:"JSON",data:{datos:datos},}).done(function(c){ManejoRespuestaProcesarComite(c);
});};var mostrarCal=function(){$("#fecha_nacimiento").focus();};var validarU=function(){$("#FormUsuario").formValidation("validate");};var validarC=function(){$("#FormComite").formValidation("validate");
};$(document).ready(function(){var a=$("#fecha_nacimiento").datetimepicker();$(document).on("click",".cal",mostrarCal);if(d.id_nivel>2&&d.comite.length>3){$("#divConsulta").show();
$("#spanConsulta").text("Es participante del Comité con el cargo: "+d.comite);}if(d.comite.length>3){boton=1;$("#divParticipante").show();$("#modal").hide();
$("#spanComite").text("Es participante del Comité con el cargo: "+d.comite);}else{boton=2;$("#divParticipante").hide();$("#modal").show();}pintarDatosActualizar(d.v_datos[0],d.condominio);
$(document).on("click","#guardar",validarU);$(document).on("click","#cancelar",Boton_cancelar);$(document).on("click","#agregar",Boton_agregar);$(document).on("click","#cargar",actualizarFoto);
$(document).on("click","#eliminar",eliminarFoto);$(document).on("click","#guardarC",validarC);$("#FormUsuario").formValidation({fields:{cedula:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},name:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},email:{validators:{notEmpty:{message:"El campo es requerido."},emailAddress:{message:"Ingrese una dirección de correo valida"}}},username:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},password:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},password_confirmation:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},identical:{field:"password",message:"La contraseña debe coincidir."},}},}}).on("success.form.fv",function(b){ProcesarUsuario();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});$("#FormComite").formValidation({fields:{cargo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},}}).on("success.form.fv",function(b){ProcesarComite();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});