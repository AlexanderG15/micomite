var RegistroSeguridad=RegistroTurnos="";var combos=caso=0;var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};
var ManejoRespuestaProcesarT=function(a){destruirTablaS("tablaTurnos");cargarTablaTurnos(a.respuesta.v_turnos);crearcombo("#id_turno",a.respuesta.v_turnos);
};var ManejoRespuestaProcesar=function(b){if(b.code=="200"){var a=JSON.parse(b.respuesta.f_registro_seguridad[0].f_registro_seguridad);switch(a.code){case"200":mensajesAlerta("Procesado!",a.des_code,"info");
$(".caja-foto").show();destruirTablaS("tablaSeguridad");cargarTablaSeguridad(b.respuesta.v_seguridad);$("#id_seguridad").val(a.id_seguridad);break;case"-2":mensajesAlerta("Error",a.des_code,"error");
break;default:mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}};var cargarTablaSeguridad=function(a){$("#tablaSeguridad").dataTable({paging:false,searching:false,info:false,columnDefs:[{targets:-1,data:null,targets:[1],searchable:true,}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id_seguridad",visible:0},{title:"RUT",data:"rut"},{title:"Nombres",data:"nombres"},{title:"Correo",data:"email"},{title:"Dirección",data:"direccion"},{title:"Teléfono",data:"telefonoresidencial"},{title:"Movil",data:"movil"}],});
};var cargarTablaTurnos=function(a){$("#tablaTurnos").dataTable({paging:false,searching:false,info:false,columnDefs:[{targets:-1,data:null,targets:[1],searchable:false,}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id",visible:0},{title:"Turno",data:"text"}],});
};var crearallcombos=function(a){crearcombo("#id_turno",a.v_turnos);crearcombo("#id_dias",a.v_dias);crearcombo("#id_tipo_seguridad",a.v_tipo_seguridad);
};var Boton_agregar=function(){$("#spanTitulo").text("Registro del personal de seguridad");$(".divForm").toggle();$(".caja-foto").hide();$("#id_seguridad").val("");
$("#FormSeguridad")[0].reset();$(".comboclear").val("").trigger("change");};var Boton_cancelar=function(){$("#spanTitulo").text("Registro del personal de seguridad");
$(".divForm").toggle();$(".caja-foto").hide();$("#id_seguridad").val("");$("#FormSeguridad")[0].reset();$("#id_seguridad").val("");$(".comboclear").val("").trigger("change");
$(".foto-perfil").attr("src","/img/foto.png")+"?"+Math.random();};var MostrarTurnos=function(){$("#modalTurnos").window("open");$("#spanTituloEncuesta").text("Registro de turnos para el personal de seguridad");
};var volverTurnos=function(){$("#modalTurnos").window("close");};var pintarDatosActualizar=function(b){$(".caja-foto").show();$(".divForm").toggle();$("#spanTitulo").text("Actualización de datos");
if(b.urlimage!=null){if(b.urlimage.length>4){$(".foto-perfil").attr("src",b.urlimage)+"?"+Math.random();$("#image").val(b.urlimage);}}if(b.id_seguridad!=null){$("#id_seguridad").val(b.id_seguridad);
}if(b.rut!=null){$("#rut").val(b.rut);}if(b.nombres!=null){$("#nombres").val(b.nombres);}if(b.email!=null){$("#email").val(b.email);}if(b.direccion!=null){$("#direccion").val(b.direccion);
}if(b.name!=null){$("#name").val(b.name);}if(b.telefonoresidencial!=null){var a=b.telefonoresidencial.split("-");$("#paist").val(a[0]);$("#codigot").val(a[1]);
$("#numerot").val(a[2]);}if(b.movil!=null){var a=b.movil.split("-");$("#paism").val(a[0]);$("#codigom").val(a[1]);$("#numerom").val(a[2]);}if(b.cargo!=null){$("#cargo").val(b.cargo);
}if(b.sueldo!=null){$("#sueldo").val(b.sueldo);}if(b.id_turno!=null){$("#id_turno").val(b.id_turno).trigger("change");}if(b.dias_semana!=null){var a=b.dias_semana.split(",");
$("#id_dias").val(a).trigger("change");}if(b.id_tipo_seguridad!=null){$("#id_tipo_seguridad").val(b.id_tipo_seguridad).trigger("change");}if(b.rut_empresa!=null){$("#rutE").val(b.rut_empresa);
}if(b.id_empresa!=null){$("#id_empresa").val(b.id_empresa);}if(b.des_empresa!=null){$("#des_empresa").val(b.des_empresa);}if(!b.activo){$("#activo").prop("checked",false);
}else{$("#activo").prop("checked",true);}};var ProcesarSeguridad=function(){var b=$("#id_dias").val().toString();var a={dias:b};parametroAjax.data=$("#FormSeguridad").serialize()+"&"+$.param(a);
parametroAjax.ruta=ruta;respuesta=procesarajax(parametroAjax);ManejoRespuestaProcesar(respuesta);};var mostrarDependientes=function(a){switch(parseInt($("#id_tipo_seguridad").val())){case 1:$("#divSegExterna").hide();
break;case 2:$("#divSegExterna").show();break;default:$("#divSegExterna").hide();break;}};var cargarTurnos=function(){caso=1;var a={caso:caso};parametroAjax.data=$("#FormTurno").serialize()+"&"+$.param(a);
parametroAjax.ruta=rutaT;respuesta=procesarajax(parametroAjax);ManejoRespuestaProcesarT(respuesta);};var elimiarTurno=function(){caso=2;var a=RegistroTurnos.id;
var b=RegistroTurnos.id_sede;parametroAjax.data={id_sede:b,cod_tabla:a,caso:caso};parametroAjax.ruta=rutaT;respuesta=procesarajax(parametroAjax);ManejoRespuestaProcesarT(respuesta);
};var consultarResponsable=function(a){parametroAjax.data={rutE:a};parametroAjax.ruta=rutaC;parametroAjax.token=$("#_token").val();var b=procesarajax(parametroAjax);
if(b.code=200){if(!jQuery.isEmptyObject(b.respuesta[0])){$("#id_empresa").val(b.respuesta[0].user_id);$("#des_empresa").val(b.respuesta[0].name);}else{mensajesAlerta("Error","Empresa no encontrada, Por favor contacte al personal Informático","error");
}}};var eliminarFoto=function(){$.ajax({url:rutaE,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",data:{id_seguridad:$("#id_seguridad").val(),urlimage:$("#image").val()},async:false,dataType:"JSON",}).done(function(a){$(".foto-perfil").attr("src","/img/foto.png")+"?"+Math.random();
destruirTablaS("tablaSeguridad");cargarTablaSeguridad(a);});};var actualizarFoto=function(){var a=$(this);var c=$(this).attr("id");if(c=="FormSeguridad"){var b="notificacion_resul_fci";
}var e=$("#FormSeguridad").get(0);var f=new FormData(e);$.ajax({url:rutaF,type:"POST",data:f,cache:false,contentType:false,processData:false,success:function(g){if(g=="-2"){alert("Debe agregar una foto");
}else{$(".foto-perfil").attr("src",g.rutadelaimagen)+"?"+Math.random();destruirTablaS("tablaSeguridad");cargarTablaSeguridad(g.v_seguridad);}},error:function(g){alert("ha ocurrido un error al cargar su foto");
},});};var validarS=function(){$("#FormSeguridad").formValidation("validate");};$(document).ready(function(){$("#spanTitulo").text("Registro del personal de seguridad");
$("#activo").prop("checked",true);$("#horaI").timepicki();$("#horaF").timepicki();cargarTablaSeguridad(d.v_seguridad);cargarTablaTurnos(d.v_turnos);crearallcombos(d);
$("#id_tipo_seguridad").change(function(){mostrarDependientes(combos);});$("#rutE").focusout(function(){var c=$("#rutE").val();if(c.length>5){consultarResponsable(c);
}});var b=$("#tablaSeguridad").dataTable();$("#tablaSeguridad tbody").on("click","tr",function(c){b.$("tr.selected").removeClass("selected");$(this).addClass("selected");
RegistroSeguridad=TablaTraerCampo("tablaSeguridad",this);});b.on("dblclick","tr",function(){$("#close").trigger("click");});$(function(){$.contextMenu({selector:"#tablaSeguridad",callback:function(e,c){switch(e){case"1":pintarDatosActualizar(RegistroSeguridad);
break;}},items:{"1":{name:"Editar",icon:"edit"},}});});var a=$("#tablaTurnos").dataTable();$("#tablaTurnos tbody").on("click","tr",function(c){a.$("tr.selected").removeClass("selected");
$(this).addClass("selected");RegistroTurnos=TablaTraerCampo("tablaTurnos",this);});a.on("dblclick","tr",function(){$("#close").trigger("click");});$(function(){$.contextMenu({selector:"#tablaTurnos",callback:function(e,c){switch(e){case"1":elimiarTurno(RegistroTurnos);
break;}},items:{"1":{name:"Eliminar",icon:"delete"},}});});$(document).on("click","#agregar",Boton_agregar);$(document).on("click","#cancelar",Boton_cancelar);
$(document).on("click","#cargar",actualizarFoto);$(document).on("click","#eliminar",eliminarFoto);$(document).on("click","#guardar",validarS);$(document).on("click","#spanTurnos",MostrarTurnos);
$(document).on("click","#cancelarT",volverTurnos);$(document).on("click","#cargarT",cargarTurnos);$(".moneda").priceFormat({prefix:"",centsSeparator:",",thousandsSeparator:"."});
$("#FormSeguridad").formValidation({fields:{rut:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},nombres:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},email:{validators:{emailAddress:{message:"Ingrese una dirección de correo valida"}}},direccion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},paism:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},codigom:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},numerom:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},cargo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},sueldo:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_turno:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_dias:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_tipo_seguridad:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},rutE:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},des_empresa:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},}}).on("success.form.fv",function(c){ProcesarSeguridad();
}).on("status.field.fv",function(f,c){c.element.parents(".form-group").removeClass("has-success");});});