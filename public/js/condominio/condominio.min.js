var Registrocondominio="";var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};var ManejoRespuesta=function(a){if(a.code=200){$("#foto-condominio1").attr("src","/img/home.png")+"?"+Math.random();
$("#foto-condominio2").attr("src","/img/home.png")+"?"+Math.random();$("#foto-condominio3").attr("src","/img/home.png")+"?"+Math.random();destruirTablaS("tablaSedes");
cargarTablaSedes(a.respuesta);}else{mensajesAlerta("Error","Ocurrio un error al eliminar las imagenes","error");}};var ManejoRespuestaProcesar=function(b){var a=JSON.parse(b.f_registro_condominio[0].f_registro_condominio);
switch(a.code){case"200":mensajesAlerta("Procesado!",a.des_code,"info");limpiarTabla();cargarTablaSedes(b.v_sedes);agregarFoto();$("#id_sede").val(a.id_sede);
$("#id_sede2").val(a.id_sede);break;case"-2":mensajesAlerta("Error",a.des_code,"error");break;default:mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}};var cargarTablaSedes=function(a){$("#tablaSedes").dataTable({columnDefs:[{targets:-1,data:null,targets:[1],searchable:true,}],language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id_sede",visible:0},{title:"Condominio",data:"des_sede"},{title:"Ciudad",data:"des_ciudad"},{title:"Comuna",data:"des_comuna"},{title:"Dirección",data:"direccion"},{title:"Teléfono",data:"telefonos"},{title:"Fondo de Reserva",data:"fondo_reserva"},{title:"Fecha de Inicio de Facturación",data:"fecha_facturacion"}],});
};var Procesarcondominio=function(){var b=$("#id_sede").val();var j=$("#des_sede").val();var k=$("#paist").val()+"-"+$("#codigot").val()+"-"+$("#numerot").val();
var e=$("#direccion").val();var a=$("#obs").val();var c="f";var g=$("#id_ciudad").val();var f=$("#id_comuna").val();var h=$("#fecha_facturacion").val();
var i=$("#fondo_reserva").val();if($("#activo_sede").is(":checked")){c="t";}datos=[];datos={id_sede:b,des_sede:j,telefono:k,direccion:e,obs:a,activo_sede:c,id_ciudad:g,id_comuna:f,fecha_facturacion:h,fondo_reserva:i};
$.ajax({url:ruta,headers:{"X-CSRF-TOKEN":$("#_token").val()},type:"POST",async:false,dataType:"JSON",data:{datos:datos},}).done(function(l){ManejoRespuestaProcesar(l);
});};var agregarFoto=function(){$("#cancelar").html(" Volver");$(".divCam").show();};var crearallcombos=function(){crearcombo("#id_ciudad","");crearcombo("#id_comuna","");
};var mostrarCal=function(){$("#fecha_facturacion").focus();};var fecha_facturacion=$("#fecha_facturacion").datetimepicker();var cargarForm=function(){$(".divCam").hide();
$("#divTabla").hide();$("#divForm").show();$("#id_sede").val("");$("#FormCondominio")[0].reset();$(".comboclear").val("").trigger("change");};var cargarTabla=function(){limpiar();
$("#divForm").hide();$("#divTabla").show();$(".divCam").hide();$("#cancelar").html(" Cancelar");};var limpiar=function(){$("#FormCondominio")[0].reset();
$("#FormFotos")[0].reset();$("#id_ciudad").val("").trigger("change");$("#id_comuna").val("").trigger("change");$("#id_sede").val("");$("#id_sede2").val("");
$("#foto-condominio1").attr("src","/img/home.png")+"?"+Math.random();$("#foto-condominio2").attr("src","/img/home.png")+"?"+Math.random();$("#foto-condominio3").attr("src","/img/home.png")+"?"+Math.random();
};var pintarDatosActualizar=function(b){$("#divTabla").hide();$("#divForm").show();$(".divCam").show();if(b.id_sede!=null){$("#id_sede").val(b.id_sede);
}if(b.id_sede!=null){$("#id_sede2").val(b.id_sede);}if(b.des_sede!=null){$("#des_sede").val(b.des_sede);}if(b.id_ciudad!=null){$("#id_ciudad").val(b.id_ciudad).trigger("change");
}if(b.id_comuna!=null){$("#id_comuna").val(b.id_comuna).trigger("change");}if(b.direccion!=null){$("#direccion").val(b.direccion);}if(b.obs!=null){$("#obs").val(b.obs);
}if(b.telefonos!=null){var a=b.telefonos.split("-");$("#paist").val(a[0]);$("#codigot").val(a[1]);$("#numerot").val(a[2]);}if(!b.activo_sede){$("#activo_sede").prop("checked",false);
}else{$("#activo_sede").prop("checked",true);}if(b.foto1!=null){if(b.foto1.length>3){$("#foto-condominio1").attr("src",b.foto1)+"?"+Math.random();}}if(b.foto2!=null){if(b.foto2.length>3){$("#foto-condominio2").attr("src",b.foto2)+"?"+Math.random();
}}if(b.foto3!=null){if(b.foto3.length>3){$("#foto-condominio3").attr("src",b.foto3)+"?"+Math.random();}}$("#cancelar").html(" Volver");};var eliminarFotoC=function(){var a=$("#id_sede2").val();
parametroAjax.ruta=rutaE;parametroAjax.data={id_sede:a};respuesta=procesarajax(parametroAjax);ManejoRespuesta(respuesta);};var actualizarFotos=function(){var a=$(this);
var c=$(this).attr("id");if(c=="FormFotos"){var b="notificacion_resul_fci";}var e=$("#FormFotos").get(0);var f=new FormData(e);$.ajax({url:rutaF,type:"POST",data:f,cache:false,contentType:false,processData:false,success:function(h){var g=JSON.parse(h);
switch(g.code){case"-2":mensajesAlerta("Error!",g.des_code,"error");break;case"200":mensajesAlerta("Procesado!",g.des_code,"info");if(g.foto1!=null){if(g.foto1.length>3){$("#foto-condominio1").attr("src",g.foto1)+"?"+Math.random();
}}if(g.foto2!=null){if(g.foto2.length>3){$("#foto-condominio2").attr("src",g.foto2)+"?"+Math.random();}}if(g.foto3!=null){if(g.foto3.length>3){$("#foto-condominio3").attr("src",g.foto3)+"?"+Math.random();
}}limpiarTabla();cargarTablaSedes(g.v_sedes);break;default:mensajesAlerta("Error!","Error de registro. Intente nuevamente, si el error persite contacte al personal informático.","error");
}},error:function(g){mensajesAlerta("Error!","ha ocurrido un error al cargar su foto","error");},});};var validarC=function(){$("#FormCondominio").formValidation("validate");
};var limpiarTabla=function(){destruirTablaS("tablaSedes");};var cargarFotos=function(){$("#divFotos").window("open");};$(document).ready(function(){$("#tituloPantalla").text(d.title);
cargarTablaSedes(d.v_sedes);crearallcombos();$(document).on("click","#guardar",validarC);$(document).on("click","#agregar",cargarForm);$(document).on("click","#cancelar",cargarTabla);
$(document).on("click","#guardarF",cargarFotos);$(document).on("click","#cargar",actualizarFotos);$(document).on("click","#eliminar",eliminarFotoC);var a=$("#tablaSedes").dataTable();
$("#tablaSedes tbody").on("click","tr",function(b){a.$("tr.selected").removeClass("selected");$(this).addClass("selected");Registrocondominio=TablaTraerCampo("tablaSedes",this);
});a.on("dblclick","tr",function(){$("#close").trigger("click");});$(function(){$.contextMenu({selector:"#tablaSedes",callback:function(c,b){switch(c){case"1":pintarDatosActualizar(Registrocondominio);
break;}},items:{"1":{name:"Editar",icon:"edit"},}});});$("#FormCondominio").formValidation({fields:{des_sede:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_ciudad:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},id_comuna:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},paist:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},codigot:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},numerot:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},fondo_reserva:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},fecha_facturacion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},direccion:{verbose:false,validators:{notEmpty:{message:"El campo es requerido."},}},}}).on("success.form.fv",function(b){Procesarcondominio();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});