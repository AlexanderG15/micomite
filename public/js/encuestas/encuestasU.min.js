var RegistroEncuestas="";var combos=caso=0;var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};var ManejoRespuestaProcesar=function(c){if(c.code=="200"){var a=JSON.parse(c.respuesta.f_votar_encuesta[0].f_votar_encuesta);
switch(a.code){case"200":mensajesAlerta("Procesado!",a.des_code,"info");var b=JSON.parse(c.respuesta.v_encuestasA);$("#divVotacion").empty();destruirTablaS("tablaEncuestas");
cargarTablaEncuestas(b);$(".divRespuesta").hide();verResultados();$("#DivVotacion").hide();$("#DivResultado").show();break;case"-2":mensajesAlerta("Error",a.des_code,"error");
break;default:mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");break;}}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}};var ManejoRespuestaO=function(b){$("#modalResultados").window("open");if(b.code=="200"){$("#spanTituloEncuesta").text(RegistroEncuestas.titulo);$("#spanDescripcionEncuesta").text(RegistroEncuestas.descripcion);
if(RegistroEncuestas.id_encuesta_propietario!=null){$("#DivResultado").show();$("#DivVotacion").hide();$(".divRespuesta").hide();verResultados();caso=1;
}else{$("#DivResultado").hide();$("#DivVotacion").show();$(".divResultado").toggle();var a=$("#divVotacion");$(jQuery.parseJSON(JSON.stringify(b.respuesta.v_opciones))).each(function(){$(a).append('<div class="row"><div class="col-md-5"></div><div class="col-md-5"><input type="radio" name="voto" id="voto" value="'+this.titulo+'"><b> '+this.titulo+"</b></div></div>");
});$(".divRespuesta").show();}}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}};var ManejoRespuestaE=function(a){if(a.code=="200"){destruirTablaS("tablaEncuestas");
cargarTablaEncuestas(a.respuesta.v_encuestasA);}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}};var ManejoRespuestaP=function(a){if(a.code=="200"){$("#opcion").val("");
destruirTablaS("tablaOpcion");cargarTablaOpciones(a.respuesta.v_opciones);}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");
}};var ManejoRespuestaR=function(b){if(b.code=="200"){var a=$("#divResultados");$(jQuery.parseJSON(JSON.stringify(b.respuesta))).each(function(){$(a).append('<div class="row"><b>'+this.titulo+":   </b>"+this.valor+" voto(s) de "+this.poblacion+'</div><div class="row"><progress id="bar" value="'+this.valor+'" max="'+this.poblacion+'"><em>12/20 components completed</em></progress></div>');
});}else{mensajesAlerta("Error","Comuniquese con el personal de sopore técnico","error");}};var cargarTablaEncuestas=function(a){$("#tablaEncuestas").dataTable({paging:true,searching:true,ordering:false,info:false,targets:0,language:{url:"/DataTables-1.10.10/de_DE-all.txt"},data:a,columns:[{title:"Id",data:"id_encuesta",visible:0},{title:"Fecha",data:"fecha",visible:0},{title:"Fecha",data:"fecha_formato",width:"10%"},{title:"Título",data:"titulo",width:"40%"},{title:"Descripción",data:"ini_descripcion",width:"50%"},],fnCreatedRow:function(e,c,b){if(c.id_encuesta_propietario==null){$(e).css("background","#FFFD9F");
}},});};function recortarTexto(b){if(b.length>0||b==null){var a=b.slice(1,3);}return b;}var Boton_agregar=function(){$("#divCargar").hide();$("#spanTitulo").text("Registro de encuestas");
$(".divForm").toggle();$("#FormVotacion")[0].reset();$("#id_encuesta").val("");$(".comboclear").val("").trigger("change");};var Boton_cancelar=function(){if(caso==1){$("#spanEncuesta").text("");
caso=0;}$("#FormVotacion")[0].reset();$("#id_encuesta").val("");$("#divVotacion").empty();$("#divCargar").hide();$("#spanTitulo").text("Encuestas");$(".divForm").toggle();
};var ProcesarVotacion=function(){if($("input:radio[name=voto]:checked").val()==undefined){alert("Debe seleccionar una opción");return 0;}var b=RegistroEncuestas.id_encuesta;
var a=$("input:radio[name=voto]:checked").val();parametroAjax.data={id_encuesta:b,voto:a,};parametroAjax.ruta=rutaE;respuesta=procesarajax(parametroAjax);
ManejoRespuestaProcesar(respuesta);};var mostrarOpciones=function(){var a=RegistroEncuestas.id_encuesta;parametroAjax.data={id_encuesta:a};parametroAjax.ruta=rutaO;
respuesta=procesarajax(parametroAjax);ManejoRespuestaO(respuesta);};var volverTabla=function(){$("#modalResultados").window("close");$("#divResultados").empty();
$("#spanTituloEncuesta").text(" ");if(caso==1){$("#spanEncuesta").text("");caso=0;}$("#FormVotacion")[0].reset();$("#id_encuesta").val("");$("#divVotacion").empty();
};var votarE=function(){$("#modalResultados").window("close");};var verResultados=function(){parametroAjax.data=RegistroEncuestas;parametroAjax.ruta=rutaR;
respuesta=procesarajax(parametroAjax);ManejoRespuestaR(respuesta);};var validarV=function(){$("#FormVotacion").formValidation("validate");};$(document).ready(function(){$("#spanTitulo").text("Encuestas");
$("#activo").attr("checked",true);cargarTablaEncuestas(d.v_encuestasA);var a=$("#tablaEncuestas").dataTable();$("#tablaEncuestas tbody").on("click","tr",function(b){a.$("tr.selected").removeClass("selected");
$(this).addClass("selected");RegistroEncuestas=TablaTraerCampo("tablaEncuestas",this);mostrarOpciones(RegistroEncuestas);});a.on("dblclick","tr",function(){$("#close").trigger("click");
});$(document).on("click","#votar",validarV);$(document).on("click","#cancelar",Boton_cancelar);$(document).on("click","#cancelarR",volverTabla);$(document).on("click","#votarE",votarE);
$("#FormVotacion").formValidation({fields:{verbose:false,voto:{validators:{notEmpty:{message:"Debe seleccionar una opcion"}}},}}).on("success.form.fv",function(b){ProcesarVotacion();
}).on("status.field.fv",function(c,b){b.element.parents(".form-group").removeClass("has-success");});});